services:
  kafka:
    image: bitnami/kafka:latest #Uses Bitnami's Kafka image which comes pre-bundled with Kafka + configuration flexibility.
    container_name: kafka
    environment:
      - KAFKA_CFG_NODE_ID=1
      - KAFKA_CFG_PROCESS_ROLES=broker,controller #Sets this node to act as both broker and controller (Kafka KRaft mode â€” no need for Zookeeper).
      - KAFKA_CFG_LISTENERS=PLAINTEXT://:9092,CONTROLLER://:9093,EXTERNAL://0.0.0.0:9094
        # Kafka will listen on three ports:
        # 9092 for internal communication between services (in docker).
        # 9093 for controller (KRaft).
        # 9094 exposed externally for producers/consumers on your host machine.
      - KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://kafka:9092,EXTERNAL://localhost:9094
        # What Kafka advertises as its address to other clients:
        # Internal containers should use kafka:9092.
        # External apps (e.g., NodeJS producer on your host) should use localhost:9094.
      - KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=1@kafka:9093
      - KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT,EXTERNAL:PLAINTEXT
      - KAFKA_CFG_CONTROLLER_LISTENER_NAMES=CONTROLLER
      - KAFKA_CFG_INTER_BROKER_LISTENER_NAME=PLAINTEXT
      - ALLOW_PLAINTEXT_LISTENER=yes
       # Allows plaintext communication (no SSL/SASL)

    ports:
      - "9094:9094" 
      # Maps Kafka's external listener (9094) from the container to your host machine.
    networks:
      - kafka-network
      # Uses a custom Docker network so Kafka UI can communicate with Kafka broker.

  kafka-ui:
    image: provectuslabs/kafka-ui:latest
    # A web-based UI to view Kafka topics, messages, consumer groups, etc.
    container_name: kafka-ui
    depends_on:
      - kafka
    ports:
      - '8081:8080'
    environment:
      - KAFKA_CLUSTERS_0_NAME=local-cluster
      - KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=kafka:9092
      - KAFKA_CLUSTERS_0_READONLY=false
      - KAFKA_CLUSTERS_0_TOPIC_AUTO_CREATE=true
    networks:
      - kafka-network

networks:
  kafka-network:
    driver: bridge